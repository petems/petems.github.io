name: Simple Content Validation

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Validate file structure
      run: |
        echo "üîç Validating file structure..."
        if [ ! -f "index.html" ]; then
          echo "‚ùå index.html is missing"
          exit 1
        fi
        if [ ! -f "styles.css" ]; then
          echo "‚ùå styles.css is missing"
          exit 1
        fi
        if [ ! -f "script.js" ]; then
          echo "‚ùå script.js is missing"
          exit 1
        fi
        echo "‚úÖ All required files present"
        
    - name: Check HTML syntax
      run: |
        echo "üîç Checking HTML syntax..."
        # Basic HTML validation
        if ! grep -q "<!DOCTYPE html>" index.html; then
          echo "‚ùå Missing DOCTYPE declaration"
          exit 1
        fi
        if ! grep -q "<html" index.html; then
          echo "‚ùå Missing html tag"
          exit 1
        fi
        if ! grep -q "<head" index.html; then
          echo "‚ùå Missing head tag"
          exit 1
        fi
        if ! grep -q "<body" index.html; then
          echo "‚ùå Missing body tag"
          exit 1
        fi
        echo "‚úÖ HTML structure is valid"
        
    - name: Check CSS syntax
      run: |
        echo "üîç Checking CSS syntax..."
        # Basic CSS validation - check for common syntax errors
        if grep -q "{[^}]*$" styles.css; then
          echo "‚ùå Unclosed CSS braces detected"
          exit 1
        fi
        if grep -q ";[^}]*}" styles.css; then
          echo "‚ùå Missing semicolon before closing brace"
          exit 1
        fi
        echo "‚úÖ CSS syntax appears valid"
        
    - name: Check JavaScript syntax
      run: |
        echo "üîç Checking JavaScript syntax..."
        # Basic JS validation using node
        if ! node -c script.js; then
          echo "‚ùå JavaScript syntax error detected"
          exit 1
        fi
        echo "‚úÖ JavaScript syntax is valid"
        
    - name: Check file sizes
      run: |
        echo "üìä Checking file sizes..."
        echo "HTML size: $(wc -c < index.html) bytes"
        echo "CSS size: $(wc -c < styles.css) bytes"
        echo "JS size: $(wc -c < script.js) bytes"
        
        # Warn if files are too large
        if [ $(wc -c < index.html) -gt 50000 ]; then
          echo "‚ö†Ô∏è  HTML file is larger than 50KB"
        fi
        if [ $(wc -c < styles.css) -gt 100000 ]; then
          echo "‚ö†Ô∏è  CSS file is larger than 100KB"
        fi
        if [ $(wc -c < script.js) -gt 50000 ]; then
          echo "‚ö†Ô∏è  JavaScript file is larger than 50KB"
        fi
        
    - name: Check accessibility basics
      run: |
        echo "‚ôø Checking basic accessibility..."
        # Check for alt attributes on images
        if grep -q "<img" index.html && ! grep -q "alt=" index.html; then
          echo "‚ö†Ô∏è  Images found without alt attributes"
        fi
        
        # Check for semantic HTML elements
        if ! grep -q "<main>" index.html; then
          echo "‚ö†Ô∏è  No <main> element found"
        fi
        
        if ! grep -q "<nav>" index.html; then
          echo "‚ö†Ô∏è  No <nav> element found"
        fi
        
        if ! grep -q "<header>" index.html; then
          echo "‚ö†Ô∏è  No <header> element found"
        fi
        
        if ! grep -q "<footer>" index.html; then
          echo "‚ö†Ô∏è  No <footer> element found"
        fi
        
        echo "‚úÖ Basic accessibility checks completed"
        
    - name: Check for broken links
      run: |
        echo "üîó Checking for broken links..."
        # Extract all links from HTML
        grep -o 'href="[^"]*"' index.html | sed 's/href="//;s/"$//' | while read link; do
          if [[ $link == http* ]]; then
            echo "Checking external link: $link"
            if ! curl -s --head "$link" > /dev/null; then
              echo "‚ö†Ô∏è  Broken link detected: $link"
            fi
          fi
        done
        
    - name: Create validation summary
      run: |
        echo "## ‚úÖ Validation Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Files Validated:" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ index.html" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ styles.css" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ script.js" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ README.md" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Checks Completed:" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ File structure validation" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ HTML syntax validation" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ CSS syntax validation" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ JavaScript syntax validation" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ File size analysis" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ Basic accessibility checks" >> $GITHUB_STEP_SUMMARY
        echo "- ‚úÖ Link validation" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "üéâ All validation checks passed!"